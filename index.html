<html>
	<head>
        <style media="screen">
            .bar {
                fill: #00b6f1;
                z-index: 2;
            }

            .tick {
                font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
                font-size: 12px;
                color: #494949;
            }

            .grid line {
                stroke: lightgrey;
                stroke-opacity: 0.7;
                shape-rendering: crispEdges;
                z-index: 1;
            }

            .grid path {
                stroke-width: 0;
                z-index: 1;
            }

        </style>
	</head>

	<body onload="setLabel()">

        <!--pie chart svg-->
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
        	 width="320.03px" height="320px" viewBox="0 0 320.03 320" enable-background="new 0 0 320.03 320" xml:space="preserve">
        <g>
        	<path fill="#DDDEDD" d="M299.938,82.434l-55.432,30.727c7.708,13.875,12.114,29.84,12.114,46.839c0,53.362-43.26,96.62-96.62,96.62
        		V320c28.278,0,52.837-6.35,77.57-20.063C314.86,257.101,342.779,159.719,299.938,82.434z"/>
        	<path fill="#00B6F1" d="M63.379,160c0-53.362,43.259-96.621,96.622-96.621c36.363,0,68.018,20.094,84.505,49.781l55.432-30.727
        		C270.81,29.878,220.09,0,160.001,0C71.633,0,0,71.635,0,160c0,88.367,71.633,160,160.001,160v-63.38
        		C106.639,256.62,63.379,213.362,63.379,160z"/>
        </g>
        <text transform="matrix(1 0 0 1 121.6807 161.2344)">
            <tspan x="0" y="0" fill="#00B6F1" font-family="'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'" font-size="30.2931">$6.70</tspan>
            <tspan x="1.43" y="19.245" fill="#00B6F1" font-family="'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'" font-size="16.0375">out of $10</tspan></text>
        </svg>
        <!--pie end-->

        <div id="holder"></div>

		<button id="switch" onclick="flipData()" label-raw="Show raw data" label-adjusted="Show adjusted data"></button>

		<script src="https://d3js.org/d3.v5.min.js"></script>
		<script type="text/javascript">

        function make_y_gridlines() {
            return d3.axisLeft(donationScale)
            .ticks(10)
        }

			var key = "adjusted";

			var rawData = [
				{mode: 'Walking', raw: 7.41, adjusted: 6.95},
				{mode: 'Bicycle', raw: 6.92, adjusted: 7.36},
				{mode: 'Bus', raw: 5.8, adjusted: 6.37},
				{mode: 'Train/Rail', raw: 5.71, adjusted: 5.52},
				{mode: 'Driving', raw: 7.19, adjusted: 6.88},
			];

			function projectData(key) {
				return rawData.map(function(r) {
					return {mode: r.mode, v: r[key]};
				});
			}

			function setLabel() {
				var btn = document.getElementById("switch");
				btn.innerHTML = btn.getAttribute("label-" + (key == 'raw' ? 'adjusted' : 'raw'));
			}

			function flipData() {
				key = key === 'raw' ? 'adjusted' : 'raw';

				setLabel();

				bars.data(projectData(key))
					.transition()
					.duration(1000)
					.attr('y', function(d) {
						return donationScale(d.v);
					})
					.attr('height', function(d) {
						return height - donationScale(d.v);
					});
			}

			data = projectData(key);

			var margin = {top: 5, right: 5, bottom: 50, left: 50};
			// here, we want the full chart to be 700x200, so we determine
			// the width and height by subtracting the margins from those values
			var fullWidth = 450;
			var fullHeight = 450;
			// the width and height values will be used in the ranges of our scales
			var width = fullWidth - margin.right - margin.left;
			var height = fullHeight - margin.top - margin.bottom;
			var svg = d3.select('#holder').append('svg')
				.attr('width', fullWidth)
				.attr('height', fullHeight)
				// this g is where the bar chart will be drawn
				.append('g')
				// translate it to leave room for the left and top margins
				.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

			// x value determined by month
			var modeScale = d3.scaleBand()
				.domain(data.map(function(t) {
					return t.mode
				}))
				.range([0, width])
				.paddingInner(0.4);

			// the width of the bars is determined by the scale
			var bandwidth = modeScale.bandwidth();

			var maxDonation = 10;
			var donationScale = d3.scaleLinear()
				.domain([0, maxDonation])
				.range([height, 0])
				.nice();

			var xAxis = d3.axisBottom(modeScale);
			var yAxis = d3.axisLeft(donationScale);

			// draw the axes
			svg.append('g')
				.classed('x axis', true)
				.attr('transform', 'translate(0,' + height + ')')
				.call(xAxis);

			var yAxisEle = svg.append('g')
				.classed('y axis', true)
				.call(yAxis);

			// add a label to the yAxis
			var yText = yAxisEle.append('text')
				.attr('transform', 'rotate(-90)translate(-' + height/2 + ',0)')
				.style('text-anchor', 'middle')
				.style('fill', '#494949')
				.attr('dy', '-2.5em')
				.style('font-size', '12px')
                .style('font-family', 'Helvetica Neue, Helvetica, Arial, sans-serif')
				.text('Mean donation $');

            // add the Y gridlines
            svg.append("g")
                .attr("class", "grid")
                .call(make_y_gridlines()
                .tickSize(-width)
                .tickFormat("")
                )

			var barHolder = svg.append('g')
				.classed('bar-holder', true);

			var bars = barHolder.selectAll('rect.bar')
				.data(data)
				.enter().append('rect')
				.classed('bar', true)
				.attr('x', function(d, i) {
					// the x value is determined using the
					// month of the datum
					return modeScale(d.mode)
				})
				.attr('width', bandwidth)
				.attr('y', function(d) {
					// this value is the top edge of the rectangle
					return donationScale(d.v);
				})
				.attr('height', function(d) {
					// the bar's height should align it with the base of the chart (y=0)
					return height - donationScale(d.v);
				});

		</script>
	</body>
</html>
